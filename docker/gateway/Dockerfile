# TODO Get this running on GKE
FROM golang:1.23.4-alpine
ARG IMAGE_VERSION
ENV IMAGE_VERSION ${IMAGE_VERSION}
ARG GCP_PROJECT_ID
ENV GCP_PROJECT_ID ${GCP_PROJECT_ID}
ARG TOPIC_ID
ENV TOPIC_ID ${TOPIC_ID}
ARG INTERPRETER_GRPC_CLOUD_RUN_URI
ENV INTERPRETER_GRPC_CLOUD_RUN_URI ${INTERPRETER_GRPC_CLOUD_RUN_URI}
COPY ${GOOGLE_APPLICATION_CREDENTIALS} .
ARG GOOGLE_APPLICATION_CREDENTIALS
ENV GOOGLE_APPLICATION_CREDENTIALS ${GOOGLE_APPLICATION_CREDENTIALS}
RUN mkdir /app
ADD . /app
WORKDIR /app
RUN go get cloud.google.com/go/pubsub
RUN go build -o main ./cmd/gateway
CMD ["/app/main"]
